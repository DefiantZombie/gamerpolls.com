<form action="/poll/{{#isEditing}}{{poll._id}}/edit{{/isEditing}}{{^isEditing}}new{{/isEditing}}" method="post">
	{{#isEditing}}
	<h1>Editing Poll</h1>
	{{/isEditing}}
	<h2>Question</h2>
	<div class="form-group">
		<input type="text" class="form-control input-lg" name="question" placeholder="Enter a question..." value="{{poll.question}}">
	</div>

	<h2>Answers</h2>
	<div class="answers-container">
		{{#poll.answers}}
		<div class="form-group">
			<input type="text" class="form-control input-lg" name="answers[]" placeholder="Enter an answer..." value="{{text}}">
		</div>
		{{/poll.answers}}
		<div class="form-group">
			<input type="text" class="form-control input-lg" name="answers[]" placeholder="Enter an answer...">
		</div>
		<div class="form-group">
			<input type="text" class="form-control input-lg" name="answers[]" placeholder="Enter an answer...">
		</div>
		<div class="form-group">
			<input type="text" class="form-control input-lg" name="answers[]" placeholder="Enter an answer...">
		</div>
	</div>

	{{#yield-ich}}
	<script id="blankanswer" type="text/html">
		<div class="form-group">
			<input type="text" class="form-control input-lg" name="answers[]" placeholder="Enter an answer...">
		</div>
	</script>
	{{/yield-ich}}

	<fieldset>
		<legend>Options</legend>
		<div class="form-group">
			<label class="answer">
				<div class="input-group">
					<span class="input-group-addon">
						<input type="checkbox" name="multipleChoice"{{#poll.multipleChoice}} checked{{/poll.multipleChoice}}>
					</span>
					<p class="form-control">Allow multiple choice</p>
				</div>
			</label>
			<label class="answer">
				<div class="input-group">
					<span class="input-group-addon">
						<input type="checkbox" name="allowSameIP"{{#poll.allowSameIP}} checked{{/poll.allowSameIP}}>
					</span>
					<p class="form-control">Allow multiple votes from one IP</p>
				</div>
			</label>
			{{^loggedIn}}
			<label class="answer">
				<div class="input-group">
					<span class="input-group-addon">
						<input type="checkbox" disabled>
					</span>
					<p class="form-control">Login for following/subscription options</p>
				</div>
			</label>
			{{/loggedIn}}

			{{#loggedIn}}

			<label class="answer">
				<div class="input-group">
					<span class="input-group-addon">
						<input type="radio" name="pollType" value="normal" checked>
					</span>
					<p class="form-control">Normal Poll</p>
				</div>
			</label>
			{{^user.hasSubButton}}
			<label class="answer">
				<div class="input-group">
					<span class="input-group-addon">
						<input type="radio" name="pollType" value="mustFollow"{{#poll.mustFollow}} checked{{/poll.mustFollow}}>
					</span>
					<p class="form-control">Followers only poll</p>
				</div>
			</label>
			{{/user.hasSubButton}}

			{{#user.hasSubButton}}
			<label class="answer">
				<div class="input-group">
					<span class="input-group-addon">
						<input type="radio" name="pollType" value="mustSub"{{#poll.mustSub}} checked{{/poll.mustSub}}>
					</span>
					<p class="form-control">Subscribers only poll</p>
				</div>
			</label>
			{{/user.hasSubButton}}

			<label class="answer">
				<div class="input-group">
					<span class="input-group-addon">
						<input type="radio" name="pollType" value="isVersus"{{#poll.isVersus}} checked{{/poll.isVersus}}>
					</span>
					<p class="form-control">Versus poll</p>
				</div>
			</label>
			{{/loggedIn}}
		</div>
	</fieldset>
	<input type="submit" value="{{#isEditing}}Save Changes{{/isEditing}}{{^isEditing}}Create Poll{{/isEditing}}" class="btn btn-lg btn-success btn-block">
	{{#isEditing}}
	<a href="/poll/{{poll._id}}" class="btn btn-lg btn-danger btn-block">Discard Changes</a>
	{{/isEditing}}
</form>

{{#yield-scripts}}
<script>
	$(function () {
		$('.answers-container').on('focus', '.form-group:last-child input', function () {
			ich.blankanswer().appendTo('.answers-container');
		});

		{{#isEditing}}
		var socket = utils.getSocket();
		socket.on('vote', function () {
			window.location.href = '/poll/{{poll._id}}/';				
		});
		{{/isEditing}}
	});
</script>
{{/yield-scripts}}
